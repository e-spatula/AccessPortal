/* Access portal library */
#include "Arduino.h"
#include "AccessPortal.h"
#include "ESP8266WiFi.h"
#include "WiFiClientSecure.h"
#include "string"
const char* host = "auth.uwamakers.com";
const int httpsPort = 443;


AccessPortal::AccessPortal(char* ssid, char* password, char* token) {
  Serial.begin(115200);
  _ssid = ssid;
  _password = password;
  _token = token;
}

bool AccessPortal::connect() {
  WiFi.mode(WIFI_STA);
  WiFi.begin(_ssid, _password);
  Serial.println("Connecting");
  while(WiFi.status() !=WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println(WiFi.localIP());
  WiFiClientSecure client;
  if(!client.connect(host, httpsPort)) {
    Serial.println("Connection Failed");
    return false;
  }
  return true;
}

int AccessPortal::hexToInt(char character) {
  if(int(character) -  '0' < 10) {
    return int(character)  - '0';
  }
  else {
    if(isupper(character)) {
      return int(character) - '7';
    }
    else {
      return int(character) - 'W';
    }
  }
}


void AccessPortal::getByteArray(std::string uidInput, int* uidOutput ) {
//  int byteArray[4];
  int intArray[8];
  int counter = 0;
  for(int i = 0; i < 8; i++) {
    if(i % 2 == 0) {
      intArray[i] = hexToInt(uidInput[i]) * 16;
    }
    else {
      intArray[i] = hexToInt(uidInput[i]);
    }
  }
  for(int i = 1; i < 8; i = i + 2) {
    uidOutput[counter] = intArray[i - 1]  + intArray[i];
    counter ++;
  }
}
